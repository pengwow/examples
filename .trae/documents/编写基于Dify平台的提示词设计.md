# 基于Dify平台的提示词设计

## 1. 提示词结构设计

### 1.1 SYSTEM角色提示词
```
你是一位专业的邮件分析助手，负责根据给定的邮件信息进行分类、分析和总结。

## 分析类型定义
- **关注**: 需要关注的数据，如重要通知、会议提醒、关键项目更新等
- **审批建议**: 需要审批的数据，提供决策参考，如采购申请、报销审批、请假申请等
- **不处理**: 敏感的数据，如个人隐私信息、财务数据、机密文件等需要保护的内容
- **正文总结**: 提取邮件核心信息，简洁明了

## 输出格式要求
请严格按照以下JSON格式输出，不得添加任何额外内容：
{
  "uid": "邮件唯一标识符",
  "title": "邮件标题",
  "sender": "邮件发送人",
  "analysis_type": "分析类型，取值为：关注、审批建议、不处理",
  "approval_suggestions": ["审批建议列表，仅当analysis_type为审批建议时必填"],
  "content_summary": "邮件正文核心总结",
  "sensitive_content": "识别到的敏感内容，仅当analysis_type为不处理时必填"
}

## 规则和约束
1. 请确保分析类型准确，严格按照定义分类
2. 审批建议需清晰、具体，编号格式为：采1、采2...
3. 内容总结需提取核心信息，避免冗余
4. 敏感内容需明确指出具体的敏感信息类型
5. 所有字段必须填写，不得留空
```

### 1.2 USER角色提示词
```
请根据以下邮件信息进行分析：

邮件标题：关于2024年Q3项目预算审批的通知
发送人：财务部 <finance@company.com>
邮件正文：尊敬的部门经理，您好！附件是2024年Q3项目预算草案，请您于本周五前完成审批。本次预算总额为150万元，主要用于新产品研发和市场推广。如有疑问，请联系财务部李经理。
邮件UID：20240615_001

请按照要求分析该邮件，并输出符合格式要求的JSON。
```

## 2. 示例输出

```json
{
  "uid": "20240615_001",
  "title": "关于2024年Q3项目预算审批的通知",
  "sender": "财务部 <finance@company.com>",
  "analysis_type": "审批建议",
  "approval_suggestions": ["采1：确认预算总额150万元是否符合部门规划", "采2：审核预算分配是否合理，重点关注新产品研发和市场推广的比例", "采3：确保在本周五前完成审批并反馈"]
  "content_summary": "财务部通知部门经理于本周五前完成2024年Q3项目预算（总额150万元，用于新产品研发和市场推广）的审批，如有疑问联系李经理。",
  "sensitive_content": ""
}
```

## 3. 验证步骤

### 3.1 结构验证
1. 检查输出是否为有效的JSON格式
2. 检查所有必填字段是否存在
3. 检查字段类型是否正确

### 3.2 内容验证
1. 检查analysis_type是否为允许的值：关注、审批建议、不处理
2. 检查当analysis_type为审批建议时，approval_suggestions是否为非空数组
3. 检查当analysis_type为不处理时，sensitive_content是否为非空字符串
4. 检查approval_suggestions的格式是否符合要求（采1、采2...）
5. 检查content_summary是否准确提取了邮件核心信息

### 3.3 完整性验证
1. 检查所有输入字段（uid、title、sender）是否正确传递到输出中
2. 检查分析结果是否符合邮件内容
3. 检查是否有遗漏的重要信息

## 4. 前置动作集成

### 4.1 邮件数据提取
在调用Dify API前，需要从邮件系统中提取以下字段：
- 邮件标题（title）
- 发送人（sender）
- 邮件正文（content）
- 邮件唯一标识符（uid）

### 4.2 API调用示例
```python
import requests
import json

# 邮件数据
exmail_data = {
    "title": "关于2024年Q3项目预算审批的通知",
    "sender": "财务部 <finance@company.com>",
    "content": "尊敬的部门经理，您好！附件是2024年Q3项目预算草案，请您于本周五前完成审批。本次预算总额为150万元，主要用于新产品研发和市场推广。如有疑问，请联系财务部李经理。",
    "uid": "20240615_001"
}

# Dify API调用
url = "https://api.dify.ai/v1/chat/completions"
headers = {
    "Authorization": "Bearer YOUR_API_KEY",
    "Content-Type": "application/json"
}

data = {
    "model": "your-model-name",
    "messages": [
        {
            "role": "system",
            "content": "你是一位专业的邮件分析助手..."  # SYSTEM提示词
        },
        {
            "role": "user",
            "content": f"请根据以下邮件信息进行分析：\n\n邮件标题：{exmail_data['title']}\n发送人：{exmail_data['sender']}\n邮件正文：{exmail_data['content']}\n邮件UID：{exmail_data['uid']}\n\n请按照要求分析该邮件，并输出符合格式要求的JSON。"
        }
    ]
}

response = requests.post(url, headers=headers, data=json.dumps(data))
result = response.json()
```

## 5. 应用场景扩展

### 5.1 自动分类归档
根据analysis_type将邮件自动分类归档到不同文件夹

### 5.2 审批流程集成
将审批建议自动推送到审批系统，加速审批流程

### 5.3 敏感信息保护
识别敏感内容并自动标记或加密

### 5.4 智能提醒
对重要的关注类邮件发送提醒通知

## 6. 优化建议

1. 定期更新SYSTEM提示词，优化分析类型定义
2. 根据实际业务场景调整审批建议的生成规则
3. 结合机器学习模型，提高分类准确性
4. 添加更多分析维度，如优先级、紧急程度等
5. 支持多语言邮件分析

## 7. 测试用例

### 7.1 测试用例1：审批建议类型
```
邮件标题：关于购买新办公设备的申请
发送人：行政部 <admin@company.com>
邮件正文：尊敬的领导，您好！由于现有办公设备老化，影响工作效率，申请购买10台新电脑，预算总额为5万元。请审批。
邮件UID：20240615_002
```

### 7.2 测试用例2：关注类型
```
邮件标题：紧急会议通知
发送人：CEO办公室 <ceo@company.com>
邮件正文：全体部门经理请注意，明天上午10点在会议室召开紧急会议，讨论公司战略调整。请准时参加。
邮件UID：20240615_003
```

### 7.3 测试用例3：不处理类型
```
邮件标题：员工工资明细
发送人：人力资源部 <hr@company.com>
邮件正文：尊敬的员工，您好！附件是您2024年5月的工资明细，请查收。包含基本工资、绩效奖金、社保公积金等信息。
邮件UID：20240615_004
```