# 最终工单入仓人工确认功能实现方案

## 需求汇总
1. 每月5-10日执行当年01-01至今的工单入仓确认操作
2. 有变化的工单需人工确认后入仓，无变化的工单直接入仓
3. 事件工单入终态，问题工单和变更工单入全量
4. 入仓后的数据如果再次发生变化，则忽略，以入仓时为准
5. 只保留一个副本，每次入仓成功后删除原有副本
6. 模拟入仓为生成json数据，工单关键字段为id、sn、status、create_time、update_time
7. 变化工单根据update_time判断，人工确认后添加确认字段

## 实现步骤
1. **定义数据结构**：创建工单类，包含关键字段
2. **历史数据管理**：保存工单及入仓时间，用于判断变化
3. **模拟数据生成**：生成包含历史和新工单的模拟数据
4. **日期判断**：检查当前日期是否在每月5-10日范围内
5. **工单筛选**：筛选当年01-01至今的工单
6. **变化判断**：对比当前工单与历史数据，仅考虑入仓后变化的工单
7. **人工确认模拟**：模拟人工确认流程，添加确认字段
8. **入仓逻辑**：生成不同类型的入仓数据
9. **文件管理**：生成json文件，更新历史记录

## 代码结构设计
```python
import json
import os
from datetime import datetime

# 历史数据文件路径
HISTORY_FILE = "work_order_history.json"
# 入仓数据文件路径
WAREHOUSE_FILE = "warehouse_data.json"

# 工单类定义
class WorkOrder:
    def __init__(self, id, sn, status, create_time, update_time):
        self.id = id
        self.sn = sn
        self.status = status
        self.create_time = create_time
        self.update_time = update_time

# 读取历史数据
def load_history():
    pass

# 保存历史数据
def save_history(history_data):
    pass

# 模拟数据生成函数
def generate_sample_work_orders():
    pass

# 日期判断函数
def is_in_valid_date_range():
    pass

# 工单筛选函数
def filter_work_orders(work_orders):
    pass

# 变化工单判断函数
def get_changed_work_orders(current_orders, historical_data):
    pass

# 人工确认模拟函数
def simulate_manual_confirmation(changed_orders):
    pass

# 工单入仓函数
def warehouse_work_orders(work_orders, confirmed_orders, historical_data):
    pass

# 主函数
def main():
    pass

if __name__ == "__main__":
    main()
```

## 关键实现细节
1. **历史数据结构**：
   ```json
   {
       "work_orders": {
           "工单ID": {
               "id": "工单ID",
               "update_time": "更新时间",
               "warehouse_time": "入仓时间"
           }
       }
   }
   ```

2. **变化判断逻辑**：
   - 如果工单不在历史数据中，视为新工单，需要确认
   - 如果工单在历史数据中，比较update_time和warehouse_time
   - 只有当update_time > warehouse_time时，才认为工单有变化

3. **入仓后处理**：
   - 入仓成功后，更新历史数据中的warehouse_time为当前时间
   - 后续即使工单再次变化，只要update_time <= warehouse_time，就忽略变化

4. **确认字段**：
   - 为人工确认的工单添加`confirmed`字段
   - 包含确认时间和确认人信息

5. **入仓数据格式**：
   - 根据工单类型和状态生成不同格式的json数据
   - 事件工单入终态，问题工单和变更工单入全量

## 预期输出
- 生成模拟工单数据
- 输出符合条件的工单列表
- 输出需要人工确认的工单列表
- 生成入仓json数据文件
- 更新历史数据记录
- 输出入仓结果信息